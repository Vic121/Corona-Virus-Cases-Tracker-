jQuery(document).ready((function($){var covid_world_timeline=[],getMapdata=$("#cvct-map-data").html(),covid_total_timeline=[];if(null!=getMapdata){var mapdataObj=JSON.parse(getMapdata);null!=mapdataObj.covid_world_timeline&&covid_world_timeline.push(mapdataObj.covid_world_timeline),null!=mapdataObj.covid_total_timeline&&covid_total_timeline.push(mapdataObj.covid_total_timeline),generateChart(covid_total_timeline,covid_world_timeline)}function generateChart(covid_total_timeline,covid_world_timeline){var cvctMaptitle=$("#cvct_wrapper").attr("data-title");am4core.useTheme(am4themes_animated),am4core.useTheme(am4themes_dark),am4core.ready((function(){for(var backgroundColor=am4core.color("#1e2128"),activeColor=am4core.color("#ff8726"),confirmedColor=am4core.color("#d21a1a"),recoveredColor=am4core.color("#45d21a"),deathsColor=am4core.color("#1c5fe5"),colors={active:activeColor,confirmed:confirmedColor,recovered:recoveredColor,deaths:deathsColor},countryColor=am4core.color("#3b3b3b"),countryStrokeColor=am4core.color("#000000"),buttonStrokeColor=am4core.color("#ffffff"),countryHoverColor=am4core.color("#1b1b1b"),activeCountryColor=am4core.color("#0f0f0f"),currentIndex,currentCountry="World",lastDate,currentDate=new Date(covid_total_timeline[covid_total_timeline.length-1].date),currentPolygon,countryDataTimeout,sliderAnimation,countryIndexMap={},list=covid_world_timeline[0].list,i=0;i<list.length;i++){var country=list[i];countryIndexMap[country.id]=i}for(var i=0;i<covid_total_timeline.length;i++){var di;(di=covid_total_timeline[i]).active=di.confirmed-di.recovered}function getSlideData(index){null==index&&(index=covid_world_timeline.length-1);for(var data=covid_world_timeline[index],i=0;i<data.list.length;i++)data.list[i].name=idToName(data.list[i].id);return data}function idToName(id){return am4geodata_data_countries2[id]?am4geodata_data_countries2[id].country:id}for(var slideData=getSlideData(),mapData=JSON.parse(JSON.stringify(slideData.list)),max={confirmed:0,recovered:0,deaths:0},i=0;i<mapData.length;i++){var di;(di=mapData[i]).confirmed>max.confirmed&&(max.confirmed=di.confirmed),di.recovered>max.recovered&&(max.recovered=di.recovered),di.deaths>max.deaths&&(max.deaths=di.deaths),max.active=max.confirmed}var container=am4core.create("cvct_map",am4core.Container);container.width=am4core.percent(100),container.height=am4core.percent(100);var mapChart=container.createChild(am4maps.MapChart);mapChart.height=am4core.percent(80),mapChart.zoomControl=new am4maps.ZoomControl,mapChart.zoomControl.align="right",mapChart.zoomControl.marginRight=15,mapChart.zoomControl.valign="middle",mapChart.zoomControl.minusButton.events.on("hit",showWorld),mapChart.seriesContainer.background.events.on("hit",showWorld),mapChart.seriesContainer.background.events.on("over",resetHover),mapChart.seriesContainer.background.fillOpacity=0,mapChart.zoomEasing=am4core.ease.sinOut,mapChart.geodata=am4geodata_worldLow,mapChart.projection=new am4maps.projections.Miller,mapChart.panBehavior="move",mapChart.backgroundSeries.mapPolygons.template.polygon.fillOpacity=.05,mapChart.backgroundSeries.mapPolygons.template.polygon.fill=am4core.color("#ffffff"),mapChart.backgroundSeries.hidden=!0;var polygonSeries=mapChart.series.push(new am4maps.MapPolygonSeries);polygonSeries.dataFields.id="id",polygonSeries.exclude=["AQ"],polygonSeries.useGeodata=!0,polygonSeries.nonScalingStroke=!0,polygonSeries.strokeWidth=.5,polygonSeries.calculateVisualCenter=!0;var polygonTemplate=polygonSeries.mapPolygons.template,polygonHoverState,polygonActiveState;polygonTemplate.fill=countryColor,polygonTemplate.fillOpacity=1,polygonTemplate.stroke=countryStrokeColor,polygonTemplate.strokeOpacity=.15,polygonTemplate.setStateOnChildren=!0,polygonTemplate.events.on("hit",handleCountryHit),polygonTemplate.events.on("over",handleCountryOver),polygonTemplate.events.on("out",handleCountryOut),mapChart.deltaLongitude=-10,polygonTemplate.states.create("hover").properties.fill=countryHoverColor,polygonTemplate.states.create("active").properties.fill=activeCountryColor;var bubbleSeries=mapChart.series.push(new am4maps.MapImageSeries);bubbleSeries.data=mapData,bubbleSeries.dataFields.value="confirmed",bubbleSeries.dataFields.id="id",bubbleSeries.tooltip.animationDuration=0,bubbleSeries.tooltip.showInViewport=!1,bubbleSeries.tooltip.background.fillOpacity=.2,bubbleSeries.tooltip.getStrokeFromObject=!0,bubbleSeries.tooltip.getFillFromObject=!1,bubbleSeries.tooltip.background.fillOpacity=.2,bubbleSeries.tooltip.background.fill=am4core.color("#000000");var imageTemplate=bubbleSeries.mapImages.template,imageHoverState;imageTemplate.nonScaling=!0,imageTemplate.strokeOpacity=0,imageTemplate.fillOpacity=.5,imageTemplate.tooltipText="{name}: [bold]{value}[/]",imageTemplate.adapter.add("tooltipY",(function(tooltipY,target){return-target.children.getIndex(0).radius})),imageTemplate.events.on("over",handleImageOver),imageTemplate.events.on("out",handleImageOut),imageTemplate.events.on("hit",handleImageHit),imageTemplate.states.create("hover").properties.fillOpacity=1;var circle=imageTemplate.createChild(am4core.Circle);circle.hiddenState.properties.scale=1e-4,circle.hiddenState.transitionDuration=2e3,circle.defaultState.transitionDuration=2e3,circle.defaultState.transitionEasing=am4core.ease.elasticOut,circle.applyOnClones=!0,bubbleSeries.heatRules.push({target:circle,property:"radius",min:3,max:30,dataField:"value"}),bubbleSeries.events.on("dataitemsvalidated",(function(){bubbleSeries.dataItems.each(dataItem=>{var mapImage=dataItem.mapImage,circle=mapImage.children.getIndex(0);0==mapImage.dataItem.value?circle.hide(0):(circle.isHidden||circle.isHiding)&&circle.show()})})),imageTemplate.adapter.add("latitude",(function(latitude,target){var polygon=polygonSeries.getPolygonById(target.dataItem.id);return polygon?(target.disabled=!1,polygon.visualLatitude):(target.disabled=!0,latitude)})),imageTemplate.adapter.add("longitude",(function(longitude,target){var polygon=polygonSeries.getPolygonById(target.dataItem.id);return polygon?(target.disabled=!1,polygon.visualLongitude):(target.disabled=!0,longitude)}));var title=mapChart.titles.create();title.fontSize="1.5em",title.text=cvctMaptitle,title.align="left",title.horizontalCenter="left",title.marginLeft=20,title.paddingBottom=10,title.y=20;var mapGlobeSwitch=mapChart.createChild(am4core.SwitchButton);mapGlobeSwitch.align="right",mapGlobeSwitch.y=15,mapGlobeSwitch.leftLabel.text="Map",mapGlobeSwitch.rightLabel.text="Globe",mapGlobeSwitch.verticalCenter="top",mapGlobeSwitch.events.on("toggled",(function(){mapGlobeSwitch.isActive?(mapChart.projection=new am4maps.projections.Orthographic,mapChart.backgroundSeries.show(),mapChart.panBehavior="rotateLongLat",polygonSeries.exclude=[]):(mapChart.projection=new am4maps.projections.Miller,mapChart.backgroundSeries.hide(),mapChart.panBehavior="move",polygonSeries.data=[],polygonSeries.exclude=["AQ"])}));var buttonsAndChartContainer=container.createChild(am4core.Container);buttonsAndChartContainer.layout="vertical",buttonsAndChartContainer.height=am4core.percent(38),buttonsAndChartContainer.width=am4core.percent(100),buttonsAndChartContainer.valign="bottom";var nameAndButtonsContainer=buttonsAndChartContainer.createChild(am4core.Container);nameAndButtonsContainer.width=am4core.percent(100),nameAndButtonsContainer.padding(10,10,5,20),nameAndButtonsContainer.layout="grid";var countryName=nameAndButtonsContainer.createChild(am4core.Label);countryName.fontSize="1.2em",countryName.valign="middle";var buttonsContainer=nameAndButtonsContainer.createChild(am4core.Container);buttonsContainer.layout="vertical",buttonsContainer.width=am4core.percent(100),buttonsContainer.x=10,buttonsContainer.contentAlign="right";var chartAndSliderContainer=buttonsAndChartContainer.createChild(am4core.Container);chartAndSliderContainer.layout="vertical",chartAndSliderContainer.height=am4core.percent(0),chartAndSliderContainer.width=am4core.percent(0),chartAndSliderContainer.background.fill=am4core.color("#000000"),chartAndSliderContainer.background=new am4core.RoundedRectangle,chartAndSliderContainer.background.cornerRadius(30,30,0,0),chartAndSliderContainer.background.fillOpacity=.15,chartAndSliderContainer.paddingTop=15,chartAndSliderContainer.paddingBottom=0;var sliderContainer=chartAndSliderContainer.createChild(am4core.Container);sliderContainer.width=am4core.percent(0),sliderContainer.padding(0,15,15,10),sliderContainer.layout="horizontal";var slider=sliderContainer.createChild(am4core.Slider);slider.width=am4core.percent(0),slider.valign="middle",slider.background.opacity=.4,slider.opacity=0,slider.background.fill=am4core.color("#ffffff"),slider.marginLeft=20,slider.marginRight=35,slider.height=15,slider.start=1,slider.events.on("rangechanged",(function(event){var index=Math.round((covid_world_timeline.length-1)*slider.start);updateMapData(getSlideData(index).list),updateTotals(index)}));var lineChart=chartAndSliderContainer.createChild(am4charts.XYChart);lineChart.fontSize="0",lineChart.paddingRight=0,lineChart.paddingLeft=0,lineChart.maskBullets=!1,lineChart.zoomOutButton.disabled=!0,lineChart.paddingBottom=0,lineChart.data=JSON.parse(JSON.stringify(covid_total_timeline));var dateAxis=lineChart.xAxes.push(new am4charts.DateAxis),valueAxis=lineChart.yAxes.push(new am4charts.ValueAxis),activeSeries=addSeries("active",activeColor);activeSeries.tooltip.disabled=!0,activeSeries.hidden=!1;var confirmedSeries,recoveredSeries,deathsSeries,series={active:activeSeries,confirmed:addSeries("confirmed",confirmedColor),recovered:addSeries("recovered",recoveredColor),deaths:addSeries("deaths",deathsColor)};function addSeries(name,color){var series=lineChart.series.push(new am4charts.LineSeries);series.dataFields.valueY=name,series.dataFields.dateX="date",series.name=capitalizeFirstLetter(name),series.strokeOpacity=.6,series.stroke=color,series.maskBullets=!1,series.minBulletDistance=10,series.hidden=!0,series.hideTooltipWhileZooming=!0;var bullet=series.bullets.push(new am4charts.CircleBullet),bulletHoverState=bullet.states.create("hover");bullet.setStateOnChildren=!0,bullet.circle.fillOpacity=1,bullet.circle.fill=backgroundColor,bullet.circle.radius=2;var circleHoverState=bullet.circle.states.create("hover");return circleHoverState.properties.fillOpacity=1,circleHoverState.properties.fill=color,circleHoverState.properties.scale=1.4,series.tooltip.pointerOrientation="down",series.tooltip.getStrokeFromObject=!0,series.tooltip.getFillFromObject=!1,series.tooltip.background.fillOpacity=.2,series.tooltip.background.fill=am4core.color("#000000"),series.tooltip.dy=-4,series.tooltip.fontSize="0.8em",series.tooltipText="{valueY}",series}var confirmedButton,recoveredButton,deathsButton,activeButton,buttons={confirmed:addButton("confirmed",confirmedColor),recovered:addButton("recovered",recoveredColor),deaths:addButton("deaths",deathsColor),active:addButton("active",activeColor)};function addButton(name,color){var button=buttonsContainer.createChild(am4core.Button),activeHoverState;button.label.valign="middle",button.fontSize="1em",button.background.cornerRadius(30,30,30,30),button.background.strokeOpacity=.3,button.background.fillOpacity=0,button.background.stroke=buttonStrokeColor,button.background.padding(2,3,2,3),button.states.create("active"),button.setStateOnChildren=!0,button.background.states.create("hoverActive").properties.fillOpacity=0;var circle=new am4core.Circle;circle.radius=8,circle.fillOpacity=.3,circle.fill=buttonStrokeColor,circle.strokeOpacity=0,circle.valign="middle",circle.marginRight=5,button.icon=circle,button.dummyData=name;var circleActiveState=circle.states.create("active");return circleActiveState.properties.fill=color,circleActiveState.properties.fillOpacity=.5,button.events.on("hit",handleButtonClick),button}function handleButtonClick(event){changeDataType(event.target.dummyData)}function changeDataType(name){var activeButton=buttons[name];for(var key in activeButton.isActive=!0,buttons)buttons[key]!=activeButton&&(buttons[key].isActive=!1);bubbleSeries.dataFields.value=name,bubbleSeries.invalidateData(),bubbleSeries.mapImages.template.fill=colors[name],bubbleSeries.mapImages.template.stroke=colors[name],bubbleSeries.mapImages.template.children.getIndex(0).fill=colors[name],dateAxis.tooltip.background.fill=colors[name],dateAxis.tooltip.background.stroke=colors[name];var activeSeries=series[name];for(var key in activeSeries.show(),series)series[key]!=activeSeries&&series[key].hide();bubbleSeries.heatRules.getIndex(0).maxValue=max[name]}function selectCountry(mapPolygon){if(resetHover(),polygonSeries.hideTooltip(),currentPolygon==mapPolygon)return currentPolygon.isActive=!1,currentPolygon=void 0,void showWorld();currentPolygon=mapPolygon;var countryIndex=countryIndexMap[mapPolygon.dataItem.id];currentCountry=mapPolygon.dataItem.dataContext.name,polygonSeries.mapPolygons.each((function(polygon){polygon.isActive=!1})),countryDataTimeout&&clearTimeout(countryDataTimeout),countryDataTimeout=setTimeout((function(){setCountryData(countryIndex)}),1e3),updateTotals(currentIndex),updateCountryName(),mapPolygon.isActive=!0,mapGlobeSwitch.isActive?1!=mapChart.zoomLevel?(mapChart.goHome(),rotateAndZoom(mapPolygon)):rotateAndZoom(mapPolygon):mapChart.zoomToMapObject(mapPolygon,getZoomLevel(mapPolygon))}function setCountryData(countryIndex){for(var i=0;i<lineChart.data.length;i++){var di,countryData=covid_world_timeline[i].list[countryIndex],dataContext=lineChart.data[i];countryData?(dataContext.recovered=countryData.recovered,dataContext.confirmed=countryData.confirmed,dataContext.deaths=countryData.deaths,dataContext.active=countryData.confirmed-countryData.recovered-countryData.deaths,valueAxis.min=void 0,valueAxis.max=void 0):(dataContext.recovered=0,dataContext.confirmed=0,dataContext.deaths=0,dataContext.active=0,valueAxis.min=0,valueAxis.max=10)}lineChart.invalidateRawData(),updateTotals(currentIndex),setTimeout(updateSeriesTooltip,2e3)}function updateSeriesTooltip(){lineChart.series.each((function(series){series.isHidden||(series.tooltip.disabled=!1,series.showTooltipAtDataItem(series.tooltipDataItem))}))}function rollOverCountry(mapPolygon){if(resetHover(),mapPolygon){mapPolygon.isHover=!0;var image=bubbleSeries.getImageById(mapPolygon.dataItem.id);image&&(image.isHover=!0)}}function rollOutCountry(mapPolygon){var image=bubbleSeries.getImageById(mapPolygon.dataItem.id);resetHover(),image&&(image.isHover=!1)}function rotateAndZoom(mapPolygon){var animation;polygonSeries.hideTooltip(),mapChart.animate([{property:"deltaLongitude",to:-mapPolygon.visualLongitude},{property:"deltaLatitude",to:-mapPolygon.visualLatitude}],1e3).events.on("animationended",(function(){mapChart.zoomToMapObject(mapPolygon,getZoomLevel(mapPolygon))}))}function getZoomLevel(mapPolygon){var w=mapPolygon.polygon.bbox.width,h=mapPolygon.polygon.bbox.width;return Math.min(mapChart.seriesWidth/(2*w),mapChart.seriesHeight/(2*h))}function showWorld(){currentCountry="World",currentPolygon=void 0,resetHover(),countryDataTimeout&&clearTimeout(countryDataTimeout),polygonSeries.mapPolygons.each((function(polygon){polygon.isActive=!1})),updateCountryName();for(var i=0;i<lineChart.data.length;i++){var di=covid_total_timeline[i],dataContext=lineChart.data[i];dataContext.recovered=di.recovered,dataContext.confirmed=di.confirmed,dataContext.deaths=di.deaths,dataContext.active=di.confirmed-di.recovered,valueAxis.min=void 0,valueAxis.max=void 0}lineChart.invalidateRawData(),updateTotals(currentIndex),mapChart.goHome()}function updateCountryName(){countryName.text=currentCountry+", "+mapChart.dateFormatter.format(currentDate,"MMM dd, yyyy")}function updateTotals(index){if(!isNaN(index)){var di=covid_total_timeline[index],date=new Date(di.date);currentDate=date,updateCountryName();var position=dateAxis.dateToPosition(date);position=dateAxis.toGlobalPosition(position);var x=dateAxis.positionToCoordinate(position);for(var key in lineChart.cursor&&lineChart.cursor.triggerMove({x:x,y:0},"soft",!0),buttons)buttons[key].label.text=capitalizeFirstLetter(key)+": "+lineChart.data[index][key];currentIndex=index}}function updateMapData(data){bubbleSeries.dataItems.each((function(dataItem){dataItem.dataContext.confirmed=0,dataItem.dataContext.deaths=0,dataItem.dataContext.recovered=0,dataItem.dataContext.active=0}));for(var i=0;i<data.length;i++){var di=data[i],image=bubbleSeries.getImageById(di.id);image&&(image.dataItem.dataContext.confirmed=di.confirmed,image.dataItem.dataContext.deaths=di.deaths,image.dataItem.dataContext.recovered=di.recovered,image.dataItem.dataContext.active=di.confirmed-di.recovered-di.deaths)}bubbleSeries.invalidateRawData()}function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)}function populateCountries(list){var table=$("#areas tbody");table.find(".area").remove();for(var i=0;i<list.length;i++){var area=list[i],tr=$("<tr>").addClass("area").data("areaid",area.id).appendTo(table).on("click",(function(){selectCountry(polygonSeries.getPolygonById($(this).data("areaid")))})).hover((function(){rollOverCountry(polygonSeries.getPolygonById($(this).data("areaid")))}));$("<td>").appendTo(tr).data("areaid",area.id).html(area.name),$("<td>").addClass("value").appendTo(tr).html(area.confirmed),$("<td>").addClass("value").appendTo(tr).html(area.deaths),$("<td>").addClass("value").appendTo(tr).html(area.recovered)}$("#areas").DataTable({paging:!1,select:!0}).column("1").order("desc").draw()}function handleImageOver(event){rollOverCountry(polygonSeries.getPolygonById(event.target.dataItem.id))}function handleImageOut(event){rollOutCountry(polygonSeries.getPolygonById(event.target.dataItem.id))}function handleImageHit(event){selectCountry(polygonSeries.getPolygonById(event.target.dataItem.id))}function handleCountryHit(event){selectCountry(event.target)}function handleCountryOver(event){rollOverCountry(event.target)}function handleCountryOut(event){rollOutCountry(event.target)}function resetHover(){polygonSeries.mapPolygons.each((function(polygon){polygon.isHover=!1})),bubbleSeries.mapImages.each((function(image){image.isHover=!1}))}container.events.on("layoutvalidated",(function(){dateAxis.tooltip.hide(),updateTotals(currentIndex)})),populateCountries(slideData.list),updateCountryName(),changeDataType("confirmed"),setTimeout((function(){$("#cvct_wrapper table tbody tr:first-child").trigger("click")}),2e3),setTimeout(updateSeriesTooltip,3e3)}))}}));